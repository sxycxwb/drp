@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script src="~/Content/js/jsrender/jsrender.min.js"></script>
<script>
    var keyValue = $.request("keyValue");
    $(function () {
        if (!!keyValue) {
            $.ajax({
                url: "/DrpServManage/Customer/GetProductJson",
                data: { keyValue: keyValue },
                dataType: "json",
                async: false,
                success: function (data) {
                    var productListHtml = $("#listTemplate").render(data);
                    $("#productList").html(productListHtml);
                    initControl();
                }
            });
        }
    });

    function initControl() {
        $('input').iCheck({
            checkboxClass: 'icheckbox_flat-green'
        });
    }

    function submitForm() {
        var str = "";
        var ids = "";
        $("input[name='pck']:checkbox").each(function () {
            if (true == $(this).is(':checked')) {
                str += $(this).val() + ",";
            }
        });
        if (str.substr(str.length - 1) == ',') {
            ids = str.substr(0, str.length - 1);
        }
        $.submitForm({
            url: "/DrpServManage/Customer/SubmitProduct",
            param: { productIds: ids, keyValue: keyValue },
            success: function () {
                $.currentWindow().$("#gridList").trigger("reloadGrid");
            }
        });
    }
</script>
<style>
    .checkProduct {
        margin-left: 10px;
        font-size: 14px;
    }
</style>
<form id="form1" ng-app="app">
    <div style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <div style="padding-top: 20px; margin-right: 30px;" id="productList">

        </div>
        <script type="text/x-jsrender" id="listTemplate">
            <label class="checkProduct">
                <input type="checkbox" name="pck" value="{{:productId}}" {{if (isChecked)}} checked {{/if}} "> {{:productName}}
            </label>
        </script>
    </div>
</form>
